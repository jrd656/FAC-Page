if (self.CavalryLogger) { CavalryLogger.start_js(["enPLw"]); }

__d("EventsToggle",["CSS","Event"],(function(a,b,c,d,e,f){__p&&__p();a=function(){"use strict";__p&&__p();function a(a,c,d,e,f){this.$1=c;this.$2=d;this.$3=a;this.$4=e;this.$5=f;c=this.toggle.bind(this);this.$5&&this.$5.href&&b("Event").listen(this.$5,"click",this.clickTitle);this.$4?b("Event").listen(this.$4,"click",c):this.$1&&b("Event").listen(this.$1,"click",c)}var c=a.prototype;c.toggle=function(){this.$3&&b("CSS").toggleClass(this.$3,"hidden_elem"),this.$1&&b("CSS").toggle(this.$1),this.$2&&b("CSS").toggle(this.$2)};c.clickTitle=function(a){a.stopPropagation()};return a}();e.exports=a}),null);
__d("XEventsSuggestionRefreshController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/events/permalink/related_event/refresh/",{fetch_num:{type:"Int",defaultValue:1},key:{type:"String"},seed_eid:{type:"Int"},cursor:{type:"Int",defaultValue:0},displayed_events:{type:"IntVector"},acontext:{type:"StringToStringMap",required:!0},filter_data:{type:"StringToStringMap",defaultValue:{}},pager_data:{type:"StringToStringMap"},removed_eid:{type:"Int"},row_id:{type:"String"}})}),null);
__d("EventSuggestionFetcher",["csx","cx","Animation","Arbiter","AsyncRequest","CSS","DOM","XEventsSuggestionRefreshController","$"],(function(a,b,c,d,e,f,g,h){__p&&__p();a={_displayedIDs:{},_eventsCache:{},_replacementRequestCache:{},addDisplayedEvent:function(a){this._displayedIDs[a]=(this._displayedIDs[a]||0)+1},removeDisplayedEvent:function(a){this._displayedIDs[a]--,this._displayedIDs[a]===0&&delete this._displayedIDs[a]},_computeCacheKey:function(a){return JSON.stringify(a.filter_data)+JSON.stringify(a.acontext)},replace:function(a,b,c,d){if(!c)return;var e=this._computeCacheKey(c);if(!this._addReplacementRequest(e,a,b,d))return;this._setFetchData(e,c);this._replaceFromCache(e)},_addReplacementRequest:function(a,b,c,d){this._replacementRequestCache[a]||(this._replacementRequestCache[a]=[]);for(var e=0;e<this._replacementRequestCache[a].length;e++)if(this._replacementRequestCache[a][e].eid===b)return!1;this._replacementRequestCache[a].push({eid:b,row_id:c,callback:d});return!0},_setFetchData:function(a,b){if(this._eventsCache[a])return;this._eventsCache[a]={events:[],fetchdata:{filter_data:b.filter_data,acontext:b.acontext,seed_eid:b.seed_eid,cursor:0},fetching:!1}},_replaceFromCache:function(a){__p&&__p();while(this._replacementRequestCache[a].length>0)if(this._isCacheEmpty(a)){this._fetchEvent(a);return}else{var b=this._popFirstCachedEvent(a),c=this._replacementRequestCache[a].shift();this._replaceItem(c.row_id,b.item,b.divider);this.removeDisplayedEvent(c.eid);c.callback()}},_isCacheEmpty:function(a){return!this._eventsCache[a]||this._eventsCache[a].events.length===0},cacheEvents:function(a,b,c){if(!this._eventsCache[b])return;this._eventsCache[b].fetchdata.curser=c;this._eventsCache[b].fetching=!1;a.forEach(function(a){this._eventsCache[b].events.push({event_id:a.id,item:a.item,divider:a.divider})},this);this._replaceFromCache(b)},_popFirstCachedEvent:function(a){if(!this._eventsCache[a]||this._eventsCache[a].events.length===0)return null;var b=this._eventsCache[a].events.shift();this._eventsCache[a].events.length===0&&delete this._eventsCache[a];return b},_fetchEvent:function(a){if(!this._eventsCache[a]||this._eventsCache[a].fetching)return;this._eventsCache[a].fetching=!0;var c=this._eventsCache[a].fetchdata,d=this._replacementRequestCache[a][0];c=b("XEventsSuggestionRefreshController").getURIBuilder().setInt("fetch_num",6).setString("key",a).setInt("seed_eid",c.seed_eid).setInt("cursor",c.cursor).setIntVector("displayed_events",Object.keys(this._displayedIDs)).setStringToStringMap("filter_data",c.filter_data).setStringToStringMap("acontext",c.acontext).setStringToStringMap("pager_data",{fetch_num:6,key:a}).setInt("removed_eid",d.eid).setString("row_id",d.row_id).getURI();new(b("AsyncRequest"))(c).setErrorHandler(function(){this._eventsCache[a].fetching=!1}.bind(this)).send()},_replaceItem:function(a,c,d){var e=b("$")(a);b("CSS").addClass(e,"fbEventsSuggestionRemovingItem");b("DOM").insertAfter(e,c);d&&b("DOM").insertBefore(e,d);new(b("Animation"))(e).to("opacity",0).duration(500).ondone(function(){b("CSS").hide(e),b("CSS").addClass(c,"fbEventsSuggestionShowingItem"),b("CSS").show(c),b("DOM").remove(e),e=null,new(b("Animation"))(c).from("opacity",0).to("opacity",1).ondone(function(){d&&(b("DOM").remove(d),d=null),c.style.opacity=null,b("CSS").removeClass(c,"fbEventsSuggestionShowingItem"),b("Arbiter").inform("EventSuggestion/insert")}).duration(300).ease(b("Animation").ease.end).show().go()}.bind(this)).ease(b("Animation").ease.end).hide().go()},_removeItem:function(a){a=b("$")(a);b("DOM").remove(a)},_clearEmptyCard:function(a){a=b("$")(a);var c=b("DOM").scry(a,"div.fbEventsSuggestionItem");c.length===0&&(c=b("DOM").scry(a,"li.fbEventsSuggestionItem"));c.length===0&&b("DOM").remove(a)},clearItems:function(a,b){if(!this._eventsCache[a])return;this._eventsCache[a].fetching=!1;while(this._replacementRequestCache[a].length>0){var c=this._replacementRequestCache[a].shift();this._removeItem(c.row_id);this.removeDisplayedEvent(c.eid)}this._clearEmptyCard(b)}};e.exports=a}),null);
__d("XEventsSuggestionHideController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/events/permalink/related_event/update/",{removed_eid:{type:"Int",required:!0},acontext:{type:"StringToStringMap",required:!0},hide_type:{type:"String",required:!0}})}),null);
__d("UpdateRelatedEvents",["Arbiter","AsyncRequest","EventSuggestionFetcher","EventSuggestionHideAction","XEventsSuggestionHideController"],(function(a,b,c,d,e,f){__p&&__p();a={init:function(a,c,d){this._seedID=a,this._actionContext=c,this._data={},b("Arbiter").subscribe("EventSuggestions/report",this.reportEvent.bind(this))},setListener:function(a,c,d,e){b("EventSuggestionFetcher").addDisplayedEvent(c),this._data[c]={removed_eid:c,seed_eid:this._seedID,row_id:d,filter_data:e,acontext:this._actionContext},a.getMenu().subscribe("itemclick",function(a,d){switch(d.item.getValue()){case b("EventSuggestionHideAction").HIDE:this._hideItem(c,b("EventSuggestionHideAction").HIDE);this.replace(c);break}}.bind(this))},reportEvent:function(a,c){this._hideItem(c.eid,b("EventSuggestionHideAction").REPORT),this.replace(c.eid)},_hideItem:function(a,c){if(!this._data||!this._data[a])return;a=b("XEventsSuggestionHideController").getURIBuilder().setInt("removed_eid",this._data[a].removed_eid).setStringToStringMap("acontext",this._data[a].acontext).setString("hide_type",c).getURI();new(b("AsyncRequest"))(a).send()},replace:function(a){if(!this._data||!this._data[a])return;b("EventSuggestionFetcher").replace(a,this._data[a].row_id,this._data[a],function(){this._removeEvent(a)}.bind(this))},_removeEvent:function(a){this._data&&delete this._data[a]}};e.exports=a}),null);